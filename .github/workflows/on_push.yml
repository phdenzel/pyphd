# Workflow that triggers when commits are pushed to main upon version change

name: Main version change workflow

on:
  push:
    branches: ["main"]
    paths: ["**/__about__.py"]

jobs:
  test-install-python-version:
    name: Test install on ğŸ
    if: ${{ startsWith(github.event.head_commit.message, 'Bump') || startsWith(github.event.head_commit.message, 'bump') }}
    uses: ./.github/workflows/test-install.yml
    with:
      versions: '["3.10", "3.11", "3.12"]'
      lint: true
      pytest: true
      artifact-name: "pytest-results"

  build-package:
    name: Build distribution ğŸ“¦
    needs: test-install-python-version
    uses: ./.github/workflows/build-package.yml
    with:
      artifact-name: "package-dist"

  context-log:
    runs-on: ubuntu-latest
    steps:
      - name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"

  # publish-to-pypi:
  #   name: Publish ğŸğŸ“¦ to PyPI
  #   needs: build-package
  #   secrets: inherit
  #   uses: ./.github/workflows/publish-to-pypi.yml
  #   with:
  #     artifact-name: "package-dist"
